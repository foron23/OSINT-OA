<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OSINT OA</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Marked.js for Markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- DOMPurify for sanitizing HTML -->
    <script src="https://cdn.jsdelivr.net/npm/dompurify/dist/purify.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>üîç OSINT OA</h1>
            <p class="subtitle">Agent-based OSINT Collection & Analysis</p>
        </header>

        <!-- New Investigation Form -->
        <section class="panel new-investigation">
            <h2>‚ûï New Investigation</h2>
            <form id="collectForm" class="collect-form">
                <div class="form-row">
                    <div class="form-group flex-grow">
                        <label for="query">Query / Objective</label>
                        <input type="text" id="query" name="query" 
                               placeholder="e.g., cybersecurity news, ransomware attacks, CVE-2024-..." required>
                    </div>
                    <div class="form-group">
                        <label for="limit">Limit</label>
                        <input type="number" id="limit" name="limit" value="20" min="1" max="100">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="since">Since (optional)</label>
                        <input type="date" id="since" name="since">
                    </div>
                    <div class="form-group flex-grow">
                        <label for="scope">Scope (optional domains)</label>
                        <input type="text" id="scope" name="scope" 
                               placeholder="e.g., example.com, target.org">
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary" id="collectBtn">
                            üöÄ Start Collection
                        </button>
                    </div>
                </div>
                
                <!-- Agent Selection -->
                <div class="form-row agent-selection">
                    <div class="form-group full-width">
                        <label class="agent-mode-label">
                            <input type="checkbox" id="agentModeAuto" checked>
                            <span>ü§ñ Auto-select agents (recommended)</span>
                        </label>
                    </div>
                </div>
                <div id="agentCheckboxes" class="agent-checkboxes hidden">
                    <p class="agent-hint">Select specific agents to use in this investigation:</p>
                    <div class="agent-grid">
                        <!-- Search Agents -->
                        <div class="agent-category">
                            <h4>üîç Search</h4>
                            <label class="agent-checkbox">
                                <input type="checkbox" name="agents" value="TavilySearchAgent">
                                <span>Tavily Search</span>
                            </label>
                            <label class="agent-checkbox">
                                <input type="checkbox" name="agents" value="DuckDuckGoSearchAgent">
                                <span>DuckDuckGo</span>
                            </label>
                            <label class="agent-checkbox">
                                <input type="checkbox" name="agents" value="GoogleDorkingAgent">
                                <span>Google Dorking</span>
                            </label>
                        </div>
                        
                        <!-- Analysis Agents -->
                        <div class="agent-category">
                            <h4>üî¨ Analysis</h4>
                            <label class="agent-checkbox">
                                <input type="checkbox" name="agents" value="WebScraperAgent">
                                <span>Web Scraper</span>
                            </label>
                            <label class="agent-checkbox">
                                <input type="checkbox" name="agents" value="ThreatIntelAgent">
                                <span>Threat Intel</span>
                            </label>
                            <label class="agent-checkbox">
                                <input type="checkbox" name="agents" value="IOCAnalysisAgent">
                                <span>IOC Analysis</span>
                            </label>
                            <label class="agent-checkbox">
                                <input type="checkbox" name="agents" value="HybridOsintAgent">
                                <span>Hybrid OSINT</span>
                            </label>
                        </div>
                        
                        <!-- Identity Agents -->
                        <div class="agent-category">
                            <h4>üë§ Identity</h4>
                            <label class="agent-checkbox">
                                <input type="checkbox" name="agents" value="MaigretAgent">
                                <span>Maigret (Username)</span>
                            </label>
                            <label class="agent-checkbox">
                                <input type="checkbox" name="agents" value="HoleheAgent">
                                <span>Holehe (Email)</span>
                            </label>
                            <label class="agent-checkbox">
                                <input type="checkbox" name="agents" value="PhoneInfogaAgent">
                                <span>PhoneInfoga (Phone)</span>
                            </label>
                        </div>
                        
                        <!-- Infrastructure Agents -->
                        <div class="agent-category">
                            <h4>üåê Infrastructure</h4>
                            <label class="agent-checkbox">
                                <input type="checkbox" name="agents" value="BbotAgent">
                                <span>Bbot (Domain)</span>
                            </label>
                            <label class="agent-checkbox">
                                <input type="checkbox" name="agents" value="ReportGeneratorAgent">
                                <span>Report Generator</span>
                            </label>
                        </div>
                    </div>
                    <div class="agent-actions">
                        <button type="button" class="btn btn-sm btn-outline" id="selectAllAgents">Select All</button>
                        <button type="button" class="btn btn-sm btn-outline" id="deselectAllAgents">Deselect All</button>
                    </div>
                </div>
            </form>
            <div id="collectStatus" class="status-message hidden"></div>
        </section>

        <!-- Filters -->
        <section class="panel filters">
            <h2>üîé Filter Investigations</h2>
            <form id="filterForm" class="filter-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="filterQ">Search Query</label>
                        <input type="text" id="filterQ" name="q" placeholder="Search...">
                    </div>
                    <div class="form-group">
                        <label for="filterStatus">Status</label>
                        <select id="filterStatus" name="status">
                            <option value="">All</option>
                            <option value="started">Started</option>
                            <option value="completed">Completed</option>
                            <option value="partial">Partial</option>
                            <option value="failed">Failed</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="filterSince">Since</label>
                        <input type="date" id="filterSince" name="since">
                    </div>
                    <div class="form-group">
                        <label for="filterUntil">Until</label>
                        <input type="date" id="filterUntil" name="until">
                    </div>
                    <div class="form-group btn-group">
                        <button type="submit" class="btn btn-secondary">Apply</button>
                        <button type="button" class="btn btn-outline" id="clearFilters">Clear</button>
                    </div>
                </div>
            </form>
            <div class="auto-refresh">
                <label>
                    <input type="checkbox" id="autoRefresh"> Auto-refresh (60s)
                </label>
            </div>
        </section>

        <!-- Investigations List -->
        <section class="panel investigations">
            <h2>üìã Investigations</h2>
            <div id="runsList" class="runs-list">
                <p class="loading">Loading...</p>
            </div>
        </section>

        <!-- Run Detail -->
        <section id="runDetail" class="panel run-detail hidden">
            <div class="detail-header">
                <h2>üìÑ Investigation Detail</h2>
                <button class="btn btn-outline" id="closeDetail">‚úï Close</button>
            </div>
            <div id="runDetailContent"></div>
        </section>

        <!-- Items List -->
        <section id="itemsSection" class="panel items-section hidden">
            <h2>üì∞ Evidence Items</h2>
            <div id="itemsList" class="items-grid"></div>
        </section>

        <!-- Traces Section (Execution Timeline) -->
        <section id="tracesSection" class="panel traces-section hidden">
            <div class="traces-header">
                <h2>üî¨ Execution Traces</h2>
                <div class="traces-controls">
                    <select id="tracesFilter" class="traces-filter">
                        <option value="">All Types</option>
                        <option value="tool_call">Tool Calls</option>
                        <option value="agent_action">Agent Actions</option>
                        <option value="llm_reasoning">LLM Reasoning</option>
                        <option value="decision">Decisions</option>
                        <option value="error">Errors</option>
                    </select>
                    <button class="btn btn-outline btn-sm" id="toggleTraceData">Show Data</button>
                </div>
            </div>
            
            <!-- Traces Summary -->
            <div id="tracesSummary" class="traces-summary"></div>
            
            <!-- Traces Timeline -->
            <div id="tracesTimeline" class="traces-timeline"></div>
            
            <!-- Trace Detail Modal -->
            <div id="traceDetailModal" class="trace-detail-modal hidden">
                <div class="trace-detail-content">
                    <div class="trace-detail-header">
                        <h3>Trace Detail</h3>
                        <button class="btn btn-outline btn-sm" onclick="closeTraceDetail()">‚úï</button>
                    </div>
                    <div id="traceDetailBody"></div>
                </div>
            </div>
        </section>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal hidden">
        <div class="modal-content">
            <h3>‚ö†Ô∏è Confirm Deletion</h3>
            <p>Are you sure you want to delete this investigation?</p>
            <p>This will remove all associated items and reports.</p>
            <div class="modal-actions">
                <button class="btn btn-outline" id="cancelDelete">Cancel</button>
                <button class="btn btn-danger" id="confirmDelete">Delete</button>
            </div>
        </div>
    </div>

    <!-- Continue Investigation Modal -->
    <div id="continueModal" class="modal continue-modal hidden">
        <div class="modal-content continue-modal-content">
            <h3>üîÑ Continue Investigation</h3>
            <p class="continue-context">Continuing from: <span id="continueFromQuery"></span></p>
            
            <form id="continueForm" class="continue-form">
                <input type="hidden" id="continueRunId" name="runId">
                
                <div class="form-group">
                    <label for="newInstructions">New Instructions / Focus Areas</label>
                    <textarea id="newInstructions" name="newInstructions" 
                              placeholder="e.g., Focus on the IP addresses found, investigate the domain further..."></textarea>
                </div>
                
                <div class="form-group">
                    <label for="continueDepth">Investigation Depth</label>
                    <select id="continueDepth" name="depth">
                        <option value="quick">Quick (1-2 agents)</option>
                        <option value="standard" selected>Standard (2-4 agents)</option>
                        <option value="deep">Deep (all relevant agents)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="continueAgentModeAuto" checked>
                        ü§ñ Auto-select agents
                    </label>
                </div>
                
                <div id="continueAgentCheckboxes" class="agent-checkboxes hidden">
                    <p class="agent-hint">Select specific agents for this continuation:</p>
                    <div class="agent-grid">
                        <!-- Search Agents -->
                        <div class="agent-category">
                            <h4>üîç Search</h4>
                            <label class="agent-checkbox">
                                <input type="checkbox" name="continueAgents" value="TavilySearchAgent">
                                <span>Tavily Search</span>
                            </label>
                            <label class="agent-checkbox">
                                <input type="checkbox" name="continueAgents" value="DuckDuckGoSearchAgent">
                                <span>DuckDuckGo</span>
                            </label>
                            <label class="agent-checkbox">
                                <input type="checkbox" name="continueAgents" value="GoogleDorkingAgent">
                                <span>Google Dorking</span>
                            </label>
                        </div>
                        
                        <!-- Analysis Agents -->
                        <div class="agent-category">
                            <h4>üî¨ Analysis</h4>
                            <label class="agent-checkbox">
                                <input type="checkbox" name="continueAgents" value="WebScraperAgent">
                                <span>Web Scraper</span>
                            </label>
                            <label class="agent-checkbox">
                                <input type="checkbox" name="continueAgents" value="ThreatIntelAgent">
                                <span>Threat Intel</span>
                            </label>
                            <label class="agent-checkbox">
                                <input type="checkbox" name="continueAgents" value="IOCAnalysisAgent">
                                <span>IOC Analysis</span>
                            </label>
                        </div>
                        
                        <!-- Identity & Infra -->
                        <div class="agent-category">
                            <h4>üë§ Identity & Infra</h4>
                            <label class="agent-checkbox">
                                <input type="checkbox" name="continueAgents" value="MaigretAgent">
                                <span>Maigret</span>
                            </label>
                            <label class="agent-checkbox">
                                <input type="checkbox" name="continueAgents" value="HoleheAgent">
                                <span>Holehe</span>
                            </label>
                            <label class="agent-checkbox">
                                <input type="checkbox" name="continueAgents" value="BbotAgent">
                                <span>Bbot</span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div id="previousIocsSection" class="form-group hidden">
                    <label>Previous IOCs to Focus On</label>
                    <div id="previousIocs" class="evidence-select">
                        <!-- Populated dynamically -->
                    </div>
                </div>
                
                <div class="continue-modal-actions">
                    <button type="button" class="btn btn-outline" id="cancelContinue">Cancel</button>
                    <button type="submit" class="btn btn-primary continue-btn" id="confirmContinue">
                        üîÑ Continue Investigation
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
